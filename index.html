<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KuniCasino - –•–∞–ª—è–≤–∞ —Å –Ω—é–∞–Ω—Å–æ–º</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --primary: #00ff00;
            --primary-dark: #00cc00;
            --secondary: #000000;
            --dark-bg: #0a0a0a;
            --darker-bg: #050505;
            --light-text: #ffffff;
            --dark-text: #cccccc;
            --success: #00cc00; /* –û–±–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è Mines */
            --danger: #ff3333;
            --warning: #ffff00;
            --info: #3b82f6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--darker-bg);
            color: var(--light-text);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(0, 255, 0, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 80% 70%, rgba(0, 255, 0, 0.05) 0%, transparent 20%);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--dark-bg);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        
        .header {
            background: rgba(5, 5, 5, 0.95);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid var(--primary);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo h1 {
            background: linear-gradient(90deg, var(--primary), #ffffff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 32px;
            font-weight: 900;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }
        
        .logo i {
            font-size: 36px;
            color: var(--primary);
            filter: drop-shadow(0 0 8px var(--primary));
        }
        
        .user-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .balance-container {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 50px;
            border: 2px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.2);
        }
        
        .balance-label {
            color: var(--dark-text);
            font-size: 14px;
        }
        
        .balance-amount {
            color: var(--primary);
            font-weight: bold;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .balance-amount i {
            color: var(--warning);
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
        }
        
        .btn-login {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-register {
            background: var(--primary);
            color: var(--secondary);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.4);
        }
        
        .btn-login:hover {
            background: rgba(0, 255, 0, 0.1);
        }
        
        .btn-icon {
            padding: 8px 12px;
            min-width: 40px;
        }
        
        .user-profile {
            display: none;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 50px;
            border: 1px solid var(--primary);
            cursor: pointer;
        }
        
        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--secondary);
            font-size: 14px;
            object-fit: cover; /* –î–ª—è –∞–≤–∞—Ç–∞—Ä–∫–∏ */
            background-color: var(--primary-dark);
            border: 1px solid var(--primary);
        }
        
        .user-name {
            color: var(--light-text);
            font-weight: bold;
            font-size: 14px;
            max-width: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            padding: 30px 0;
        }
        
        /* –ë–∞–Ω–Ω–µ—Ä */
        .hero-banner {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(0, 50, 0, 0.8));
            border-radius: 20px;
            padding: 40px 30px;
            margin-bottom: 40px;
            text-align: center;
            border: 2px solid var(--primary);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .hero-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 255, 0, 0.1) 0%, transparent 70%);
            animation: pulse 4s infinite alternate;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.3; }
            100% { transform: scale(1.1); opacity: 0.5; }
        }
        
        .hero-banner h2 {
            font-size: 36px;
            margin-bottom: 15px;
            color: var(--primary);
            text-shadow: 0 0 10px var(--primary);
            position: relative;
            z-index: 1;
        }
        
        .hero-banner p {
            font-size: 18px;
            max-width: 800px;
            margin: 0 auto 20px;
            line-height: 1.6;
            color: var(--dark-text);
            position: relative;
            z-index: 1;
        }
        
        .bonus-highlight {
            display: inline-block;
            background: linear-gradient(90deg, var(--primary), #00cc00);
            color: var(--secondary);
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 20px;
            margin-top: 15px;
            box-shadow: 0 5px 20px rgba(0, 255, 0, 0.4);
            position: relative;
            z-index: 1;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        /* –ò–≥—Ä—ã */
        .games-section {
            margin-bottom: 50px;
        }
        
        .section-title {
            font-size: 32px;
            margin-bottom: 30px;
            color: var(--primary);
            text-align: center;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            position: relative;
            padding-bottom: 15px;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: var(--primary);
            box-shadow: 0 0 10px var(--primary);
        }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .game-card {
            background: rgba(10, 10, 10, 0.8);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }
        
        .game-card:hover {
            transform: translateY(-8px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(0, 255, 0, 0.3);
        }
        
        .game-card.featured {
            border-color: var(--warning);
            position: relative;
        }
        
        .featured-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--warning);
            color: var(--secondary);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            z-index: 2;
        }
        
        .game-header {
            padding: 20px;
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid rgba(0, 255, 0, 0.2);
        }
        
        .game-icon {
            font-size: 56px;
            color: var(--primary);
            margin-bottom: 12px;
            filter: drop-shadow(0 0 10px var(--primary));
        }
        
        .game-title {
            font-size: 22px;
            color: var(--light-text);
            margin-bottom: 8px;
        }
        
        .game-stats {
            display: flex;
            justify-content: center;
            gap: 15px;
            color: var(--dark-text);
            font-size: 13px;
        }
        
        .game-body {
            padding: 20px;
        }
        
        .game-description {
            color: var(--dark-text);
            line-height: 1.5;
            margin-bottom: 20px;
            min-height: 60px;
            font-size: 14px;
        }
        
        .btn-game {
            width: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: var(--secondary);
            font-weight: bold;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
        }
        
        /* –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç */
        .account-section {
            background: rgba(10, 10, 10, 0.8);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 2px solid var(--primary);
            display: none;
        }
        
        .account-section.active {
            display: block;
        }
        
        .account-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .account-header h2 {
            font-size: 28px;
            color: var(--primary);
            margin: 0;
        }
        
        .account-balance {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .balance-card {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--primary);
            min-width: 200px;
        }
        
        .balance-value {
            font-size: 32px;
            color: var(--primary);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .withdrawal-form {
            background: rgba(0, 0, 0, 0.5);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--light-text);
            font-weight: bold;
            font-size: 14px;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(0, 255, 0, 0.5);
            border-radius: 8px;
            color: var(--light-text);
            font-size: 14px;
        }

        .form-select {
            cursor: pointer;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }
        
        .btn-withdraw {
            background: linear-gradient(90deg, var(--primary), #00cc00);
            color: var(--secondary);
            width: 100%;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: rgba(10, 10, 10, 0.95);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid var(--primary);
            max-width: 500px;
            width: 100%;
            box-shadow: 0 0 50px rgba(0, 255, 0, 0.5);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-game {
            max-width: 800px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary);
        }
        
        .modal-title {
            font-size: 24px;
            color: var(--primary);
        }
        
        .close-btn {
            font-size: 28px;
            color: var(--dark-text);
            cursor: pointer;
            transition: color 0.3s;
            background: none;
            border: none;
            padding: 0;
        }
        
        .close-btn:hover {
            color: var(--primary);
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        #notificationContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .notification {
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 14px;
            color: var(--secondary);
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            min-width: 250px;
        }
        .notification.success { background-color: var(--success); }
        .notification.danger { background-color: var(--danger); }
        .notification.warning { background-color: var(--warning); }
        .notification.info { background-color: var(--info); }
        
        /* –ü–†–û–§–ò–õ–¨ */
        .profile-content-body {
            text-align: center;
        }
        .profile-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 15px;
            object-fit: cover;
            border: 3px solid var(--primary);
            background-color: var(--primary-dark);
        }
        .profile-nickname {
            font-size: 28px;
            color: var(--primary);
            margin-bottom: 5px;
        }
        .profile-description {
            color: var(--dark-text);
            margin-bottom: 20px;
            min-height: 30px;
            font-style: italic;
        }
        .profile-stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        .stat-label {
            font-size: 12px;
            color: var(--dark-text);
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 20px;
            color: var(--light-text);
            font-weight: bold;
        }

        /* –ò–≥—Ä–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        
        /* –†—É–ª–µ—Ç–∫–∞ (–û–±–Ω–æ–≤–ª–µ–Ω–æ) */
        .roulette-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 20px auto;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
            border: 8px solid var(--dark-bg);
        }

        .roulette-wheel {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .roulette-sector {
            position: absolute;
            width: 50%;
            height: 50%;
            top: 0;
            left: 50%;
            transform-origin: 0% 100%;
            /* –î–ª—è 37 —Å–µ–∫—Ç–æ—Ä–æ–≤: 360 / 37 ‚âà 9.7297deg */
        }
        
        /* –ù–∞—Å—Ç–æ—è—â–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å 37 —Å–µ–∫—Ç–æ—Ä–∞–º–∏ */
        .roulette-wheel {
            background: conic-gradient(
                #00cc00 0deg 9.73deg,
                #ff3333 9.73deg 19.46deg,
                #000000 19.46deg 29.19deg,
                #ff3333 29.19deg 38.92deg,
                #000000 38.92deg 48.65deg,
                #ff3333 48.65deg 58.38deg,
                #000000 58.38deg 68.11deg,
                #ff3333 68.11deg 77.84deg,
                #000000 77.84deg 87.57deg,
                #ff3333 87.57deg 97.3deg,
                #000000 97.3deg 107.03deg,
                #ff3333 107.03deg 116.76deg,
                #000000 116.76deg 126.49deg,
                #ff3333 126.49deg 136.22deg,
                #000000 136.22deg 145.95deg,
                #ff3333 145.95deg 155.68deg,
                #000000 155.68deg 165.41deg,
                #ff3333 165.41deg 175.14deg,
                #000000 175.14deg 184.87deg,
                #ff3333 184.87deg 194.6deg,
                #000000 194.6deg 204.33deg,
                #ff3333 204.33deg 214.06deg,
                #000000 214.06deg 223.79deg,
                #ff3333 223.79deg 233.52deg,
                #000000 233.52deg 243.25deg,
                #ff3333 243.25deg 252.98deg,
                #000000 252.98deg 262.71deg,
                #ff3333 262.71deg 272.44deg,
                #000000 272.44deg 282.17deg,
                #ff3333 282.17deg 291.9deg,
                #000000 291.9deg 301.63deg,
                #ff3333 301.63deg 311.36deg,
                #000000 311.36deg 321.09deg,
                #ff3333 321.09deg 330.82deg,
                #000000 330.82deg 340.55deg,
                #ff3333 340.55deg 350.28deg,
                #000000 350.28deg 360deg
            );
        }
        
        .roulette-pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 25px solid var(--warning); /* –Ø—Ä–∫–∞—è —Å—Ç—Ä–µ–ª–∫–∞ */
            transform: translateX(-50%);
            z-index: 10;
        }

        /* Dice */
        .dice-dot {
            position: absolute;
            width: 15px;
            height: 15px;
            background: var(--secondary);
            border-radius: 50%;
        }

        /* Mines */
        .mines-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mines-controls input {
            width: 150px;
            padding: 10px;
            background-color: var(--darker-bg);
            border: 1px solid var(--primary-dark);
            color: var(--light-text);
            border-radius: 5px;
        }

        .mines-status {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--primary);
        }

        .mines-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            width: 300px;
            height: 300px;
            margin: 0 auto;
        }

        .mines-tile {
            width: 100%;
            height: 100%;
            background-color: var(--dark-bg);
            border: 2px solid var(--primary);
            color: var(--light-text);
            font-size: 1.5em;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.1s;
        }

        .mines-tile:not(.opened):hover {
            background-color: #1a1a1a;
        }

        .mines-tile.opened {
            cursor: default;
            border-color: var(--dark-text);
        }

        .mines-tile.safe {
            background-color: var(--success);
            color: var(--dark-bg);
        }

        .mines-tile.mine-hit {
            background-color: var(--danger);
            color: var(--light-text);
            animation: pulse-danger 0.5s 2;
        }
        
        @keyframes pulse-danger {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã */
        @media (max-width: 1024px) {
            .hero-banner h2 { font-size: 32px; }
            .bonus-highlight { font-size: 18px; padding: 10px 20px; }
        }
        
        @media (max-width: 768px) {
            .games-grid { grid-template-columns: 1fr; }
            .footer-content { flex-direction: column; text-align: center; gap: 15px; }
            .account-header { flex-direction: column; align-items: flex-start; gap: 15px; }
            .balance-card { min-width: 100%; }
            .modal-content { padding: 20px; }
            .user-name { max-width: 80px; }
            .mines-grid { width: 90%; max-width: 300px; height: auto; }
        }
        
        @media (max-width: 480px) {
            .hero-banner { padding: 30px 20px; }
            .hero-banner h2 { font-size: 24px; }
            .section-title { font-size: 26px; }
            .user-actions { flex-wrap: wrap; justify-content: center; }
            .balance-container { order: -1; width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    <div id="notificationContainer"></div> 

    <div class="loader" id="loader" style="display: none;"> 
        <div class="loader-spinner"></div>
        <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div> 

    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-crown"></i>
                    <h1>KUNICASINO</h1>
                </div>
                <div class="user-actions">
                    <div class="balance-container">
                        <div class="balance-label">–ë–∞–ª–∞–Ω—Å:</div>
                        <div class="balance-amount">
                            <i class="fas fa-coins"></i>
                            <span id="profileBalance">0.00</span>
                        </div>
                    </div>
                    
                    <div id="auth-buttons" style="display: flex; gap: 10px;">
                        <button class="btn btn-login" id="loginBtn" onclick="showAuthModal('login')">–í–æ–π—Ç–∏</button>
                        <button class="btn btn-register" id="registerBtn" onclick="showAuthModal('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                    </div>

                    <div class="user-profile" id="user-info" style="display: none;" onclick="showProfileModal()">
                        <img src="https://i.imgur.com/your-default-avatar.png" class="user-avatar" id="profileAvatar" alt="–ê–≤–∞—Ç–∞—Ä">
                        <div class="user-name" id="profileNickname">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            
            <section class="hero-banner animate__animated animate__fadeIn">
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ KuniCasino!</h2>
                <p>–ò–≥—Ä–∞–π—Ç–µ –≤ –Ω–∞—à–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–≥—Ä—ã –∏ —É–º–Ω–æ–∂–∞–π—Ç–µ —Å–≤–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å.</p>
                <div class="bonus-highlight">–ë–û–ù–£–°: 1000.00$ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏!</div>
            </section>

            <section class="games-section">
                <h2 class="section-title">–ù–∞—à–∏ –∏–≥—Ä—ã</h2>
                <div class="games-grid" id="gamesGrid">
                    </div>
            </section>

            <section class="account-section" id="accountSection">
                <h2 class="section-title">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
                <div class="account-header">
                    <div class="account-balance">
                        <div class="balance-card">
                            <div style="font-size: 14px; color: var(--dark-text);">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</div>
                            <div class="balance-value">
                                <i class="fas fa-coins"></i>
                                <span id="accountBalance">0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="withdrawal-form">
                    <h4 style="color: var(--light-text); margin-bottom: 20px;">–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥</h4>
                    <div class="form-group">
                        <label class="form-label">–°—É–º–º–∞</label>
                        <input type="number" class="form-input" id="withdrawAmount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–†–µ–∫–≤–∏–∑–∏—Ç—ã (–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã / –ö–æ—à–µ–ª–µ–∫)</label>
                        <input type="text" class="form-input" id="withdrawDetails" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã">
                    </div>
                    <button class="btn btn-withdraw" id="withdrawBtn">
                        <i class="fas fa-money-bill-wave"></i> –û–§–û–†–ú–ò–¢–¨ –í–´–í–û–î
                    </button>
                </div>
            </section>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="copyright">
                    &copy; 2025 KuniCasino. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∞–π—Ç.
                </div>
                <div class="footer-links">
                    <a href="#" class="footer-link" onclick="showTerms()">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</a>
                    <a href="#" class="footer-link" onclick="showPrivacy()">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
                </div>
                <a href="https://lolz.live/eggler" target="_blank" class="author-link">
                    <i class="fas fa-user"></i> –ö—É–Ω–∏–ù–µ–¥–æ—Ä–æ–≥–æ
                </a>
            </div>
        </div>
    </footer>

    <div class="modal-overlay" id="authModal">
        <div class="modal-content animate__animated animate__fadeInDown">
            <div class="modal-header">
                <h3 class="modal-title" id="authModalTitle">–í–•–û–î –í –ê–ö–ö–ê–£–ù–¢</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="authForms">
                <div id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                    <button class="btn btn-withdraw" onclick="login()">
                        <i class="fas fa-sign-in-alt"></i> –í–û–ô–¢–ò
                    </button>
                    <div style="margin-top: 20px; text-align: center;">
                        <a href="#" style="color: var(--primary); text-decoration: none;" onclick="showRegisterForm()">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a>
                    </div>
                </div>
                <div id="registerForm" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">–ù–∏–∫–Ω–µ–π–º (–±—É–¥–µ—Ç –≤–∏–¥–µ–Ω –≤—Å–µ–º)</label>
                        <input type="text" class="form-input" id="regNickname" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–∏–∫–Ω–µ–π–º">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="regEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-input" id="regPassword" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å (–º–∏–Ω. 6 —Å–∏–º–≤–æ–ª–æ–≤)">
                    </div>
                    <button class="btn btn-withdraw" onclick="register()">
                        <i class="fas fa-user-plus"></i> –ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø
                    </button>
                    <div style="margin-top: 20px; text-align: center;">
                        <a href="#" style="color: var(--primary); text-decoration: none;" onclick="showLoginForm()">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π–¥–∏—Ç–µ</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="profileModal" onclick="closeModal(event)">
        <div class="modal-content animate__animated animate__zoomIn">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <div class="profile-content-body">
                <img src="https://i.imgur.com/your-default-avatar.png" class="profile-avatar-large" id="profileModalAvatar" alt="–ê–≤–∞—Ç–∞—Ä">
                <div class="profile-nickname" id="profileModalNickname">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <p class="profile-description" id="profileModalDescription">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                
                <div class="profile-stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
                        <div class="stat-value" id="profileModalBalance">0.00 <i class="fas fa-coins" style="color: var(--warning); font-size: 16px;"></i></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Email</div>
                        <div class="stat-value" id="profileModalEmail" style="font-size: 14px; word-break: break-all;">user@example.com</div>
                    </div>
                </div>
                
                <button class="btn btn-withdraw" onclick="showEditProfileModal()" style="width: 100%; margin-bottom: 10px;">
                    <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                </button>
                <button class="btn" onclick="logout()" style="width: 100%; background: var(--danger); color: white;">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                </button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="editProfileModal" onclick="closeModal(event)">
        <div class="modal-content animate__animated animate__zoomIn">
            <div class="modal-header">
                <h3 class="modal-title">–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–§–ò–õ–Ø</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">–ù–∏–∫–Ω–µ–π–º (—Å–º–µ–Ω–∞ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)</label>
                <input type="text" class="form-input" id="editNicknameInput" placeholder="–ù–æ–≤—ã–π –Ω–∏–∫–Ω–µ–π–º">
                <small id="nicknameCooldownStatus" style="color: var(--danger); font-size: 12px;"></small>
            </div>
            <div class="form-group">
                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –≤—Å–µ–º)</label>
                <textarea class="form-input" id="editDescriptionInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –æ —Å–µ–±–µ..." rows="3"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">URL –ê–≤–∞—Ç–∞—Ä–∫–∏ (–±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –≤—Å–µ–º)</label>
                <input type="url" class="form-input" id="editAvatarUrlInput" placeholder="https://i.imgur.com/your-image.png">
            </div>
            <button class="btn btn-withdraw" onclick="saveProfile()" style="width: 100%;">
                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
            </button>
        </div>
    </div>
    
    <div class="modal-overlay" id="messagesModal">
        <div class="modal-content modal-game animate__animated animate__zoomIn">
            <div class="modal-header">
                <h3 class="modal-title">–ú–û–ò –°–û–û–ë–©–ï–ù–ò–Ø</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div style="display: flex; height: 500px; gap: 20px;">
                <div style="flex: 1; border-right: 1px solid var(--primary-dark); padding-right: 20px; overflow-y: auto;">
                    <input type="text" class="form-input" id="userSearchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∏–∫–Ω–µ–π–º—É..." oninput="searchUsers(this.value)" style="margin-bottom: 15px;">
                    <div id="chatsList">
                        </div>
                </div>
                
                <div style="flex: 2; display: flex; flex-direction: column;">
                    <div id="chatHeader" style="margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--primary);">
                         <p style="color: var(--dark-text); text-align: center;">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</p>
                    </div> 
                    <div id="messagesList" style="flex: 1; overflow-y: auto; border: 1px solid var(--primary); padding: 10px; border-radius: 8px; margin-bottom: 15px; min-height: 300px;"> 
                        </div> 
                    <div class="form-group" style="margin-bottom: 10px;"> 
                        <input type="text" class="form-input" id="newMessage" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." disabled> 
                    </div> 
                    <button class="btn btn-withdraw" onclick="sendMessage()" disabled id="sendMessageBtn"> 
                        <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å 
                    </button> 
                </div>
            </div>
        </div>
    </div>


    <div class="modal-overlay" id="gameModal" onclick="closeGameModal(event)">
        <div class="modal-content modal-game animate__animated animate__zoomIn">
            <button class="close-btn" onclick="closeGameModal()">&times;</button>
            <div id="gameContent">
                </div>
        </div>
    </div>


    <div id="minesModal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content game-modal animate__animated animate__zoomIn">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <h3 class="modal-title" style="text-align: center; margin-bottom: 20px;">üí£ Mines (–°–∞–ø–µ—Ä)</h3>
            <div class="game-content">
                <div class="mines-controls">
                    <input type="number" id="minesBetAmount" placeholder="–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏" value="10.00" min="1" step="0.01">
                    <input type="number" id="minesCount" placeholder="–ö–æ–ª-–≤–æ –º–∏–Ω (1-24)" value="3" min="1" max="24">
                    <button id="minesStartButton" onclick="startMinesGame()" class="btn btn-register">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                    <button id="minesCashoutButton" onclick="minesCashout()" disabled class="btn btn-login">–ó–∞–±—Ä–∞—Ç—å (<span id="minesNextPayout">0.00</span>)</button>
                </div>
                <div class="mines-status" style="text-align: center; margin-bottom: 15px;">
                    –ú–Ω–æ–∂–∏—Ç–µ–ª—å: <span id="minesMultiplier">1.00x</span>
                </div>
                <div id="minesGrid" class="mines-grid">
                    </div>
            </div>
        </div>
    </div>


    <div class="modal-overlay" id="termsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–û–ï –°–û–ì–õ–ê–®–ï–ù–ò–ï</h3>
                <button class="close-btn" onclick="closeTerms()">&times;</button>
            </div>
            <div style="max-height: 400px; overflow-y: auto; padding-right: 10px;">
                <p><strong>–í–ù–ò–ú–ê–ù–ò–ï: –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–û–ù–ù–ê–Ø –í–ï–†–°–ò–Ø</strong></p>
                <p>–î–∞–Ω–Ω—ã–π —Å–∞–π—Ç —è–≤–ª—è–µ—Ç—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π –∏–≥—Ä–æ–≤–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ —Å–æ–∑–¥–∞–Ω –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö.</p>
                <h4>1. –û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è</h4>
                <p>1.1. –ù–∞—Å—Ç–æ—è—â–µ–µ –°–æ–≥–ª–∞—à–µ–Ω–∏–µ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π —Å–∞–π—Ç–∞ –∏ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.</p>
                <p>1.2. –í—Å–µ –¥–µ–Ω—å–≥–∏ –Ω–∞ —Å–∞–π—Ç–µ —è–≤–ª—è—é—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –∏ –Ω–µ –∏–º–µ—é—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏.</p>
                <h4>2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–∫–∫–∞—É–Ω—Ç</h4>
                <p>2.1. –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–ª–Ω–æ–º—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è.</p>
                <p>2.2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—è–∑–∞–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.</p>
                <h4>3. –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞</h4>
                <p>3.1. –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–µ.</p>
            </div>
        </div>
    </div>


    <script>
        // *********************************************************************************
        // ******** –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–∏ –∫–ª—é—á–∏ –Ω–∞ –≤–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ Supabase ***************
        // *********************************************************************************
        const SUPABASE_URL = 'https://dqlfbadlpjezjrsypbmy.supabase.co'; 
        const SUPABASE_ANON_KEY = 'sb_publishable_ZyER26frXSosgCwIu1pSBQ_KAamrBXB'; 
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        // *********************************************************************************
        
        let currentUser = null;
        let lastNicknameChange = 0;
        const NICKNAME_CHANGE_COOLDOWN = 7 * 24 * 60 * 60 * 1000; // 7 –¥–Ω–µ–π –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        const DEFAULT_AVATAR = 'https://i.imgur.com/your-default-avatar.png'; // –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –∞–≤–∞—Ç–∞—Ä–∫–∞

        // ==================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ò UI ====================

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification animate__animated animate__fadeInRight ${type}`;
            notification.textContent = message;

            container.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('animate__fadeOutRight');
                notification.addEventListener('animationend', () => {
                    notification.remove();
                });
            }, 5000);
        }

        function closeModal(event) {
            if (event && event.target !== event.currentTarget) return; // –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.style.display = 'none';
            });
        }

        function closeGameModal(event) {
             if (event && event.target !== event.currentTarget) return; 
             closeModal();
             // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –¥–ª—è –∏–≥—Ä
             minesState.gameActive = false;
        }

        // ==================== –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø –ò –ü–†–û–§–ò–õ–¨ ====================

        async function loadProfile() {
            showLoader();
            try {
                const { data: { user } } = await supabase.auth.getUser();
                currentUser = user;

                if (currentUser) {
                    document.getElementById('auth-buttons').style.display = 'none';
                    document.getElementById('user-info').style.display = 'flex';
                    await fetchUserProfile(currentUser.id);
                } else {
                    document.getElementById('auth-buttons').style.display = 'flex';
                    document.getElementById('user-info').style.display = 'none';
                    // –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è
                    document.getElementById('profileBalance').textContent = '0.00';
                    document.getElementById('accountBalance').textContent = '0.00';
                    document.getElementById('profileAvatar').src = DEFAULT_AVATAR;
                }
            } catch(e) {
                console.error("Load Profile Error:", e);
                showNotification("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", 'danger');
            } finally {
                hideLoader();
            }
        }

        async function fetchUserProfile(userId) {
            const { data: profile, error } = await supabase
                .from('profiles') // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É 'profiles'
                .select('nickname, balance, description, avatar_url, last_nickname_change')
                .eq('id', userId)
                .single();

            if (error && error.code === 'PGRST116') { // –ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Å–æ–∑–¥–∞—Ç—å
                await createDefaultProfile(userId, currentUser.email);
                // –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
                const { data: newProfile } = await supabase.from('profiles').select('*').eq('id', userId).single();
                updateProfileUI(newProfile);
                return;
            }
            
            if (error) {
                console.error('Error fetching profile:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è.', 'danger');
                return;
            }

            updateProfileUI(profile);
        }

        function updateProfileUI(profile) {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Header UI
            document.getElementById('profileNickname').textContent = profile.nickname || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            document.getElementById('profileBalance').textContent = profile.balance ? profile.balance.toFixed(2) : '0.00';
            document.getElementById('profileAvatar').src = profile.avatar_url || DEFAULT_AVATAR;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Account Section
            document.getElementById('accountBalance').textContent = profile.balance ? profile.balance.toFixed(2) : '0.00';

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Modal UI
            document.getElementById('profileModalNickname').textContent = profile.nickname || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            document.getElementById('profileModalBalance').textContent = profile.balance ? profile.balance.toFixed(2) : '0.00';
            document.getElementById('profileModalEmail').textContent = currentUser.email;
            document.getElementById('profileModalDescription').textContent = profile.description || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ.';
            document.getElementById('profileModalAvatar').src = profile.avatar_url || DEFAULT_AVATAR;

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            lastNicknameChange = profile.last_nickname_change ? new Date(profile.last_nickname_change).getTime() : 0;
            document.getElementById('editNicknameInput').value = profile.nickname || '';
            document.getElementById('editDescriptionInput').value = profile.description || '';
            document.getElementById('editAvatarUrlInput').value = profile.avatar_url || DEFAULT_AVATAR;
        }

        async function createDefaultProfile(userId, email) {
            const defaultNickname = `User${Math.floor(Math.random() * 10000)}`;
            const { error } = await supabase
                .from('profiles')
                .insert([{ 
                    id: userId, 
                    nickname: defaultNickname, 
                    email: email, // –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è RLS
                    balance: 1000.00, 
                    description: '–ü—Ä–∏–≤–µ—Ç! –Ø –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.',
                    avatar_url: DEFAULT_AVATAR,
                    last_nickname_change: new Date().toISOString()
                }]);

            if (error) {
                console.error('Error creating profile:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: ' + error.message, 'danger');
            }
        }
        
        // –í—Ö–æ–¥
        async function login() {
            showLoader();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            try {
                const { data, error } = await supabase.auth.signInWithPassword({ email: email, password });
                
                if (error) throw error;

                currentUser = data.user;
                await loadProfile();
                showNotification('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!', 'success');
                closeModal();

            } catch (error) {
                let message = '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞.';
                if (error.message.includes('Invalid login credentials')) {
                    message = '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å.';
                }
                showNotification(message, 'danger');
            } finally {
                hideLoader();
            }
        }
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        async function register() {
            showLoader();
            const nickname = document.getElementById('regNickname').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const password = document.getElementById('regPassword').value.trim();

            if (!nickname || !email || !password) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'warning');
                hideLoader();
                return;
            }
            if (password.length < 6) {
                showNotification('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤', 'warning');
                hideLoader();
                return;
            }

            try {
                // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–∏–∫–Ω–µ–π–º–∞
                const { data: existingUser } = await supabase
                    .from('profiles')
                    .select('id')
                    .eq('nickname', nickname)
                    .maybeSingle();

                if (existingUser) {
                    showNotification('–≠—Ç–æ—Ç –Ω–∏–∫–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç.', 'danger');
                    hideLoader();
                    return;
                }

                // 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Supabase Auth
                const { data: authData, error: authError } = await supabase.auth.signUp({ email, password });

                if (authError) throw authError;
                
                currentUser = authData.user;

                // 3. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ 'profiles')
                if (currentUser) {
                    await createDefaultProfile(currentUser.id, email);
                }

                showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.', 'success');
                closeModal();
                loadProfile(); // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –∏ UI
                
            } catch (error) {
                console.error('Registration error:', error);
                showNotification('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message, 'danger');
            } finally {
                hideLoader();
            }
        }
        
        // –í—ã—Ö–æ–¥
        async function logout() {
            showLoader();
            await supabase.auth.signOut();
            currentUser = null;
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('auth-buttons').style.display = 'flex';
            showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞.', 'info');
            closeModal();
            hideLoader();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è
        async function showProfileModal() {
            if (!currentUser) {
                showNotification('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å.', 'warning');
                return;
            }
            await fetchUserProfile(currentUser.id); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º
            document.getElementById('profileModal').style.display = 'flex';
        }

        function showEditProfileModal() {
            if (!currentUser) return;
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–ª–¥–∞—É–Ω–∞
            const now = Date.now();
            if (now - lastNicknameChange < NICKNAME_CHANGE_COOLDOWN) {
                const remainingTime = NICKNAME_CHANGE_COOLDOWN - (now - lastNicknameChange);
                const days = Math.ceil(remainingTime / (1000 * 60 * 60 * 24));
                document.getElementById('nicknameCooldownStatus').textContent = `–°–º–µ–Ω–∞ –Ω–∏–∫–Ω–µ–π–º–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ ${days} –¥–Ω.`;
            } else {
                document.getElementById('nicknameCooldownStatus').textContent = '–ù–∏–∫–Ω–µ–π–º –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å.';
                document.getElementById('nicknameCooldownStatus').style.color = 'var(--success)';
            }

            document.getElementById('profileModal').style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ñ–∏–ª—å
            document.getElementById('editProfileModal').style.display = 'flex';
        }

        async function saveProfile() {
            if (!currentUser) return;

            showLoader();
            const newNickname = document.getElementById('editNicknameInput').value.trim();
            const newDescription = document.getElementById('editDescriptionInput').value.trim();
            const newAvatarUrl = document.getElementById('editAvatarUrlInput').value.trim();
            let updateData = { description: newDescription, avatar_url: newAvatarUrl };
            let nicknameChanged = false;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ–Ω—ã –Ω–∏–∫–Ω–µ–π–º–∞
            const currentProfile = (await supabase.from('profiles').select('nickname, last_nickname_change').eq('id', currentUser.id).single()).data;
            
            if (newNickname !== currentProfile.nickname) {
                const now = Date.now();
                lastNicknameChange = new Date(currentProfile.last_nickname_change).getTime();

                if (now - lastNicknameChange < NICKNAME_CHANGE_COOLDOWN) {
                    const remainingTime = NICKNAME_CHANGE_COOLDOWN - (now - lastNicknameChange);
                    const days = Math.ceil(remainingTime / (1000 * 60 * 60 * 24));
                    showNotification(`–ù–∏–∫–Ω–µ–π–º –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ä–∞–∑ –≤ 7 –¥–Ω–µ–π. –û—Å—Ç–∞–ª–æ—Å—å: ${days} –¥–Ω.`, 'warning');
                    hideLoader();
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
                const { data: existingUser } = await supabase
                    .from('profiles')
                    .select('id')
                    .eq('nickname', newNickname)
                    .maybeSingle(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º maybeSingle –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

                if (existingUser && existingUser.id !== currentUser.id) {
                    showNotification('–≠—Ç–æ—Ç –Ω–∏–∫–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç.', 'danger');
                    hideLoader();
                    return;
                }

                updateData.nickname = newNickname;
                updateData.last_nickname_change = new Date().toISOString();
                nicknameChanged = true;
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ –ë–î
            const { error } = await supabase
                .from('profiles')
                .update(updateData)
                .eq('id', currentUser.id);

            if (error) {
                console.error('Error saving profile:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: ' + error.message, 'danger');
            } else {
                showNotification('–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                if (nicknameChanged) lastNicknameChange = Date.now();
                await fetchUserProfile(currentUser.id);
                closeModal();
            }
            hideLoader();
        }

        // ==================== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ====================

        const games = [
            { id: 1, title: '–†—É–ª–µ—Ç–∫–∞', icon: 'fas fa-dice-d20', minBet: 1, description: '–°—Ç–∞–≤—å—Ç–µ –Ω–∞ –∫—Ä–∞—Å–Ω–æ–µ, —á–µ—Ä–Ω–æ–µ –∏–ª–∏ –∑–µ–ª–µ–Ω–æ–µ (x35)!' },
            { id: 2, title: '–ö–æ—Å—Ç–∏', icon: 'fas fa-dice', minBet: 1, description: '–£–≥–∞–¥–∞–π—Ç–µ —Å—É–º–º—É –∫–æ—Å—Ç–µ–π: 7 (x6), 11 (x8) –∏–ª–∏ –î—É–±–ª–∏ (x12).' },
            { id: 3, title: 'Mines', icon: 'fas fa-bomb', minBet: 1, description: '–ù–∞—Ö–æ–¥–∏—Ç–µ —Å–µ–π—Ñ—ã –∏ –∏–∑–±–µ–≥–∞–π—Ç–µ –º–∏–Ω! –ö—ç—à–∞—É—Ç –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.' },
            // –ò–≥—Ä–∞ Plinko —É–¥–∞–ª–µ–Ω–∞ (id: 4)
        ];

        let currentBetAmount = 10.00;
        let currentBetType = 'red'; // –î–ª—è —Ä—É–ª–µ—Ç–∫–∏
        let diceBetType = '7'; // –î–ª—è –∫–æ—Å—Ç–µ–π

        function openGame(gameId) {
            if (!currentUser) {
                showNotification('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∏–≥—Ä–∞—Ç—å!', 'warning');
                return;
            }
            
            const game = games.find(g => g.id === gameId);
            const modalId = game.title;

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –¥–ª—è Mines
            if (game.title === 'Mines') {
                document.getElementById('minesModal').style.display = 'flex';
                createMinesGrid(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∫–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
                return;
            }

            // –î–ª—è —Å—Ç–∞—Ä—ã—Ö –∏–≥—Ä (–†—É–ª–µ—Ç–∫–∞, –ö–æ—Å—Ç–∏) –∏—Å–ø–æ–ª—å–∑—É–µ–º GameModal
            const gameModal = document.getElementById('gameModal');
            const content = document.getElementById('gameContent');
            content.innerHTML = `
                <h3 class="modal-title" style="text-align: center; margin-bottom: 20px;">${game.title}</h3>
                <div class="game-container" id="gameContainer-${game.id}">
                    </div>
                <div class="bet-controls" style="margin-top: 25px;">
                    <input type="number" class="form-input" id="gameBetAmount" value="${currentBetAmount.toFixed(2)}" min="1" step="0.01" style="width: 150px;">
                    <button class="btn btn-register" id="playGameBtn" onclick="playGame(${game.id})"><i class="fas fa-play"></i> –ò–ì–†–ê–¢–¨</button>
                </div>
                <div class="bet-options" id="betOptions-${game.id}">
                    </div>
                <div class="game-result" id="gameResult-${game.id}" style="display: none;">
                    <div class="result-text" id="resultText"></div>
                    <div class="result-amount" id="resultAmount"></div>
                </div>
            `;
            
            gameModal.style.display = 'flex';
            renderGameContent(gameId);
        }

        function renderGameContent(gameId) {
            const container = document.getElementById(`gameContainer-${gameId}`);
            const betOptions = document.getElementById(`betOptions-${gameId}`);
            const game = games.find(g => g.id === gameId);

            switch(gameId) {
                case 1: // –†—É–ª–µ—Ç–∫–∞
                    container.innerHTML = `
                        <div class="roulette-container">
                            <div class="roulette-wheel" id="rouletteWheel">
                                </div>
                            <div class="roulette-pointer"></div>
                        </div>
                    `;
                    betOptions.innerHTML = `
                        <div class="bet-option ${currentBetType === 'red' ? 'active' : ''}" onclick="selectRouletteBet('red')">–ö–†–ê–°–ù–û–ï (x2)</div>
                        <div class="bet-option ${currentBetType === 'black' ? 'active' : ''}" onclick="selectRouletteBet('black')">–ß–ï–†–ù–û–ï (x2)</div>
                        <div class="bet-option ${currentBetType === 'green' ? 'active' : ''}" onclick="selectRouletteBet('green')" style="background-color: var(--success); color: var(--secondary); border-color: var(--success);">–ó–ï–õ–ï–ù–û–ï (x35)</div>
                    `;
                    break;
                case 2: // –ö–æ—Å—Ç–∏
                    container.innerHTML = `
                        <div class="dice-container">
                            <div class="dice" id="dice1"></div>
                            <div class="dice" id="dice2"></div>
                        </div>
                    `;
                    updateDiceFace(document.getElementById('dice1'), 1);
                    updateDiceFace(document.getElementById('dice2'), 6);
                    betOptions.innerHTML = `
                        <div class="bet-option ${diceBetType === '7' ? 'active' : ''}" onclick="selectDiceBetType('7')">–°–£–ú–ú–ê 7 (x6)</div>
                        <div class="bet-option ${diceBetType === '11' ? 'active' : ''}" onclick="selectDiceBetType('11')">–°–£–ú–ú–ê 11 (x8)</div>
                        <div class="bet-option ${diceBetType === 'double' ? 'active' : ''}" onclick="selectDiceBetType('double')">–î–£–ë–õ–¨ (x12)</div>
                    `;
                    break;
                case 3: // Mines (–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥–∞–ª, –Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã)
                default:
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px 0;">
                            <div style="font-size: 80px; color: var(--primary);">
                                <i class="${game.icon}"></i>
                            </div>
                            <h3 style="margin: 20px 0;">${game.title}</h3>
                            <p>–ò–≥—Ä–∞ –≥–æ—Ç–æ–≤–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –µ–µ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –æ–∫–Ω–æ.</p>
                        </div>
                    `;
                    betOptions.innerHTML = '';
            }
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
            currentBetAmount = parseFloat(document.getElementById('gameBetAmount').value);
        }
        
        // --- Dice Helpers ---
        function updateDiceFace(dice, value) {
            dice.innerHTML = '';
            const dots = {
                1: [[50, 50]], 2: [[20, 20], [80, 80]], 3: [[20, 20], [50, 50], [80, 80]], 
                4: [[20, 20], [20, 80], [80, 20], [80, 80]], 
                5: [[20, 20], [20, 80], [50, 50], [80, 20], [80, 80]], 
                6: [[20, 20], [20, 50], [20, 80], [80, 20], [80, 50], [80, 80]]
            };
            dots[value].forEach(pos => {
                const dot = document.createElement('div');
                dot.className = 'dice-dot';
                dot.style.left = `${pos[0]}%`;
                dot.style.top = `${pos[1]}%`;
                dot.style.transform = 'translate(-50%, -50%)';
                dice.appendChild(dot);
            });
        }
        function selectDiceBetType(type) {
            diceBetType = type;
            document.querySelectorAll('#betOptions-2 .bet-option').forEach(opt => opt.classList.remove('active'));
            document.querySelector(`#betOptions-2 .bet-option:contains('${type === 'double' ? '–î–£–ë–õ–¨' : '–°–£–ú–ú–ê ' + type}')`).classList.add('active');
        }

        // --- Roulette Helpers ---
        function selectRouletteBet(color) {
            currentBetType = color;
            document.querySelectorAll('#betOptions-1 .bet-option').forEach(opt => opt.classList.remove('active'));
            document.querySelector(`#betOptions-1 .bet-option:contains('${color === 'red' ? '–ö–†–ê–°–ù–û–ï' : (color === 'black' ? '–ß–ï–†–ù–û–ï' : '–ó–ï–õ–ï–ù–û–ï')}')`).classList.add('active');
        }
        
        // --- Game Logic ---
        async function playGame(gameId) {
            const betInput = document.getElementById('gameBetAmount');
            const betAmount = parseFloat(betInput.value);
            const playButton = document.getElementById('playGameBtn');
            const resultElement = document.getElementById(`gameResult-${gameId}`);
            
            if (isNaN(betAmount) || betAmount < 1) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏.', 'warning');
                return;
            }
            
            playButton.disabled = true;
            playButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ò–ì–†–ê–ï–ú...';
            resultElement.style.display = 'none';

            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            const profile = (await supabase.from('profiles').select('balance').eq('id', currentUser.id).single()).data;
            if (profile.balance < betAmount) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤.', 'danger');
                playButton.disabled = false;
                playButton.innerHTML = '<i class="fas fa-play"></i> –ò–ì–†–ê–¢–¨';
                return;
            }
            
            // –°–ø–∏—Å–∞–Ω–∏–µ
            let newBalance = profile.balance - betAmount;
            const { error: deductError } = await supabase.from('profiles').update({ balance: newBalance }).eq('id', currentUser.id);
            if (deductError) {
                console.error('Deduct Error:', deductError);
                showNotification('–û—à–∏–±–∫–∞ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ç–∞–≤–∫–∏.', 'danger');
                playButton.disabled = false;
                playButton.innerHTML = '<i class="fas fa-play"></i> –ò–ì–†–ê–¢–¨';
                return;
            }
            document.getElementById('profileBalance').textContent = newBalance.toFixed(2);
            document.getElementById('accountBalance').textContent = newBalance.toFixed(2);
            
            let winAmount = 0;
            let resultMessage = '–ü—Ä–æ–∏–≥—Ä—ã—à!';

            if (gameId === 1) { // –†—É–ª–µ—Ç–∫–∞
                const { finalWinAmount, message } = await playRouletteLogic(betAmount);
                winAmount = finalWinAmount;
                resultMessage = message;
            } else if (gameId === 2) { // –ö–æ—Å—Ç–∏
                const { finalWinAmount, message } = await playDiceLogic(betAmount);
                winAmount = finalWinAmount;
                resultMessage = message;
            }

            // 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ –∏–≥—Ä—ã
            newBalance += winAmount;
            const { error: winError } = await supabase.from('profiles').update({ balance: newBalance }).eq('id', currentUser.id);

            if (winError) {
                console.error('Win Update Error:', winError);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–∏–≥—Ä—ã—à–∞.', 'danger');
            } else {
                document.getElementById('profileBalance').textContent = newBalance.toFixed(2);
                document.getElementById('accountBalance').textContent = newBalance.toFixed(2);
                showGameResult(resultElement, resultMessage, winAmount);
                showNotification(resultMessage, winAmount > betAmount ? 'success' : (winAmount === betAmount ? 'info' : 'danger'));
            }

            // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                playButton.disabled = false;
                playButton.innerHTML = '<i class="fas fa-play"></i> –ò–ì–†–ê–¢–¨';
            }, gameId === 1 ? 5000 : 1000);
        }

        async function playRouletteLogic(betAmount) {
            const ROULETTE_SECTORS = 37; // 0-36
            const SECTOR_ANGLE = 360 / ROULETTE_SECTORS;
            const ROULETTE_COLOR_MAP = {
                0: 'green', 1: 'red', 2: 'black', 3: 'red', 4: 'black', 5: 'red', 6: 'black', 7: 'red', 8: 'black', 9: 'red', 10: 'black', 11: 'red', 12: 'black', 13: 'red', 14: 'black', 15: 'red', 16: 'black', 17: 'red', 18: 'black',
                19: 'red', 20: 'black', 21: 'red', 22: 'black', 23: 'red', 24: 'black', 25: 'red', 26: 'black', 27: 'red', 28: 'black', 29: 'red', 30: 'black', 31: 'red', 32: 'black', 33: 'red', 34: 'black', 35: 'red', 36: 'black'
            }; 
            
            const wheel = document.getElementById('rouletteWheel');
            wheel.style.transition = 'none';
            wheel.style.transform = 'rotate(0deg)';

            const winningNumber = Math.floor(Math.random() * ROULETTE_SECTORS); // 0-36
            const winningColor = ROULETTE_COLOR_MAP[winningNumber];
            
            // –†–∞—Å—á–µ—Ç —É–≥–ª–∞ –≤—Ä–∞—â–µ–Ω–∏—è (–ø—Ä–∏–∑–µ–º–ª–µ–Ω–∏–µ –Ω–∞ —Ü–µ–Ω—Ç—Ä —Å–µ–∫—Ç–æ—Ä–∞ —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º —Å–º–µ—â–µ–Ω–∏–µ–º)
            // 90deg - —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ 12 —á–∞—Å–æ–≤. –°–µ–∫—Ç–æ—Ä 0 (Green) –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0deg.
            const targetSectorCenter = 360 - (winningNumber * SECTOR_ANGLE + SECTOR_ANGLE / 2);
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤ (4)
            const totalRotation = 360 * 4 + targetSectorCenter + (Math.random() * 5 - 2.5); 
            
            // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                wheel.style.transition = 'transform 4s cubic-bezier(0.25, 0.1, 0.25, 1)';
                wheel.style.transform = `rotate(${totalRotation}deg)`;
            }, 50);

            await new Promise(resolve => setTimeout(resolve, 4000)); // –û–∂–∏–¥–∞–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏

            let multiplier = 0;
            if (winningColor === currentBetType) {
                if (winningColor === 'green') {
                    multiplier = 36; // 1:35 + 1 (–≤–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞–≤–∫–∏)
                } else {
                    multiplier = 2; // 1:1 + 1 (–≤–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞–≤–∫–∏)
                }
            } else {
                multiplier = 0;
            }

            const finalWinAmount = multiplier * betAmount; // –û–±—â–∞—è —Å—É–º–º–∞ –∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—é (–≤–∫–ª—é—á–∞—è —Å—Ç–∞–≤–∫—É)
            const resultMessage = `–í—ã–ø–∞–ª–æ: ${winningNumber} (${winningColor}). ${multiplier > 0 ? '–ü–æ–±–µ–¥–∞!' : '–ü—Ä–æ–∏–≥—Ä—ã—à.'}`;
            
            return { finalWinAmount, message: resultMessage };
        }

        async function playDiceLogic(betAmount) {
            const dice1 = document.getElementById('dice1');
            const dice2 = document.getElementById('dice2');
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞
            for (let i = 0; i < 10; i++) {
                updateDiceFace(dice1, Math.floor(Math.random() * 6) + 1);
                updateDiceFace(dice2, Math.floor(Math.random() * 6) + 1);
                await new Promise(resolve => setTimeout(resolve, 50));
            }

            // –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const value1 = Math.floor(Math.random() * 6) + 1;
            const value2 = Math.floor(Math.random() * 6) + 1;
            const sum = value1 + value2;
            
            updateDiceFace(dice1, value1);
            updateDiceFace(dice2, value2);

            let winMultiplier = 0; // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤—ã–∏–≥—Ä—ã—à–∞ (–≤–∫–ª—é—á–∞—è —Å—Ç–∞–≤–∫—É)
            let resultMessage = `–í—ã–ø–∞–ª–æ: ${value1} + ${value2} = ${sum}. `;
            
            if (diceBetType === '7' && sum === 7) {
                winMultiplier = 6; // 1:5 + 1
                resultMessage += '–ü–æ–±–µ–¥–∞! –°—É–º–º–∞ 7 (x6)';
            } else if (diceBetType === '11' && sum === 11) {
                winMultiplier = 8; // 1:7 + 1
                resultMessage += '–ü–æ–±–µ–¥–∞! –°—É–º–º–∞ 11 (x8)';
            } else if (diceBetType === 'double' && value1 === value2) {
                winMultiplier = 12; // 1:11 + 1
                resultMessage += '–ü–æ–±–µ–¥–∞! –î—É–±–ª–∏ (x12)';
            } else {
                 resultMessage += '–ü—Ä–æ–∏–≥—Ä—ã—à.';
            }

            const finalWinAmount = winMultiplier * betAmount;
            return { finalWinAmount, message: resultMessage };
        }

        function showGameResult(element, message, totalPayout) {
            element.style.display = 'block';
            element.classList.remove('animate__fadeOutUp', 'animate__fadeInDown');
            element.classList.add('animate__fadeInDown');
            document.getElementById('resultText').textContent = message;
            document.getElementById('resultAmount').textContent = `–í—ã–ø–ª–∞—Ç–∞: ${totalPayout.toFixed(2)}`;
            
            setTimeout(() => {
                element.classList.remove('animate__fadeInDown');
                element.classList.add('animate__fadeOutUp');
            }, 3000);
        }

        // ==================== MINES LOGIC ====================

        let minesState = {
            gameActive: false,
            minesLocations: [],
            betAmount: 0,
            minesCount: 3,
            tilesClicked: 0,
            currentMultiplier: 1.00,
            gridSize: 25,
            initialBalance: 0 
        };

        // –¢–∞–±–ª–∏—Ü–∞ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π –¥–ª—è 3, 5, 8 –º–∏–Ω
        const MINES_PAYOUT_TABLES = {
            3: [1.04, 1.15, 1.34, 1.63, 2.09, 2.92, 4.41, 7.35, 13.97, 30.73, 80.00, 300.00, 1500.00, 15000.00],
            5: [1.09, 1.25, 1.48, 1.78, 2.19, 2.76, 3.65, 5.15, 7.87, 13.29, 25.00, 56.25, 157.5, 630.00],
            8: [1.17, 1.40, 1.70, 2.06, 2.54, 3.19, 4.14, 5.62, 7.95, 12.08, 19.67, 35.77, 76.54, 219.00]
        };

        function getMinesMultiplier(mines, clicks) {
            const table = MINES_PAYOUT_TABLES[mines] || MINES_PAYOUT_TABLES[3];
            // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ 'clicks - 1' —Ç–∞–∫ –∫–∞–∫ –º–∞—Å—Å–∏–≤ 0-–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
            return table[clicks - 1] || (table[table.length - 1] * 1.5); 
        }

        function generateMinesLocations(count, size) {
            const locations = new Set();
            while (locations.size < count) {
                locations.add(Math.floor(Math.random() * size));
            }
            return Array.from(locations);
        }

        function createMinesGrid() {
            const grid = document.getElementById('minesGrid');
            grid.innerHTML = '';
            for (let i = 0; i < minesState.gridSize; i++) {
                const tile = document.createElement('button');
                tile.className = 'mines-tile';
                tile.dataset.index = i;
                tile.onclick = () => minesClick(i, tile);
                grid.appendChild(tile);
            }
        }

        async function startMinesGame() {
            if (!currentUser) return;

            minesState.betAmount = parseFloat(document.getElementById('minesBetAmount').value);
            minesState.minesCount = parseInt(document.getElementById('minesCount').value);

            if (isNaN(minesState.betAmount) || minesState.betAmount < 1) {
                showNotification('–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å >= 1', 'warning');
                return;
            }
            if (minesState.minesCount < 1 || minesState.minesCount >= minesState.gridSize) {
                showNotification(`–ö–æ–ª-–≤–æ –º–∏–Ω –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ ${minesState.gridSize - 1}`, 'warning');
                return;
            }

            showLoader();
            const profile = (await supabase.from('profiles').select('balance').eq('id', currentUser.id).single()).data;
            if (profile.balance < minesState.betAmount) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤.', 'danger');
                hideLoader();
                return;
            }

            // –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
            minesState.initialBalance = profile.balance;
            const { error: balanceError } = await supabase.from('profiles').update({ balance: profile.balance - minesState.betAmount }).eq('id', currentUser.id);
            if (balanceError) {
                showNotification('–û—à–∏–±–∫–∞ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ç–∞–≤–∫–∏.', 'danger');
                hideLoader();
                return;
            }
            document.getElementById('profileBalance').textContent = (profile.balance - minesState.betAmount).toFixed(2);
            document.getElementById('accountBalance').textContent = (profile.balance - minesState.betAmount).toFixed(2);
            hideLoader();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
            minesState.gameActive = true;
            minesState.tilesClicked = 0;
            minesState.currentMultiplier = 1.00;
            minesState.minesLocations = generateMinesLocations(minesState.minesCount, minesState.gridSize);

            createMinesGrid();
            document.getElementById('minesStartButton').disabled = true;
            document.getElementById('minesCashoutButton').disabled = false;
            document.getElementById('minesMultiplier').textContent = '1.00x';
            document.getElementById('minesNextPayout').textContent = '0.00';
            showNotification(`–ò–≥—Ä–∞ Mines –Ω–∞—á–∞—Ç–∞! –°—Ç–∞–≤–∫–∞: ${minesState.betAmount.toFixed(2)}`, 'info');
        }

        async function minesClick(index, tile) {
            if (!minesState.gameActive || tile.classList.contains('opened')) return;

            if (minesState.minesLocations.includes(index)) {
                // –ü–û–†–ê–ñ–ï–ù–ò–ï (–ú–∏–Ω–∞)
                minesState.gameActive = false;
                tile.classList.add('mine-hit', 'opened');
                tile.innerHTML = 'üí£';
                
                // –û—Ç–∫—Ä—ã—Ç—å –≤—Å–µ –º–∏–Ω—ã
                document.querySelectorAll('.mines-tile').forEach((t, i) => {
                    t.classList.add('opened');
                    if (minesState.minesLocations.includes(i)) {
                        t.innerHTML = 'üí£';
                    } else if (!t.innerHTML) {
                         t.innerHTML = '‚≠ê';
                    }
                });
                
                showNotification(`üí• –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏! –ù–∞—à–ª–∏ –º–∏–Ω—É.`, 'danger');
                document.getElementById('minesStartButton').disabled = false;
                document.getElementById('minesCashoutButton').disabled = true;

            } else {
                // –ü–û–ë–ï–î–ê (–°–µ–π—Ñ)
                minesState.tilesClicked++;
                tile.classList.add('opened', 'safe');
                tile.innerHTML = '‚≠ê';
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è
                minesState.currentMultiplier = getMinesMultiplier(minesState.minesCount, minesState.tilesClicked);
                
                document.getElementById('minesMultiplier').textContent = `${minesState.currentMultiplier.toFixed(2)}x`;
                const nextPayout = (minesState.betAmount * minesState.currentMultiplier).toFixed(2);
                document.getElementById('minesNextPayout').textContent = nextPayout;

                if (minesState.tilesClicked >= (minesState.gridSize - minesState.minesCount)) {
                    await minesCashout(true); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∏–≥—Ä—ã—à
                }
            }
        }

        async function minesCashout(auto = false) {
            if (!minesState.gameActive && !auto) return;
            if (minesState.tilesClicked === 0) {
                 showNotification('–°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —è—á–µ–π–∫—É!', 'warning');
                 return;
            }

            minesState.gameActive = false;
            const payout = minesState.betAmount * minesState.currentMultiplier;
            
            showLoader();
            const profile = (await supabase.from('profiles').select('balance').eq('id', currentUser.id).single()).data;
            const newBalance = profile.balance + payout;

            const { error: updateError } = await supabase
                .from('profiles')
                .update({ balance: newBalance })
                .eq('id', currentUser.id);

            if (updateError) {
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–∏–≥—Ä—ã—à–∞.', 'danger');
            } else {
                document.getElementById('profileBalance').textContent = newBalance.toFixed(2);
                document.getElementById('accountBalance').textContent = newBalance.toFixed(2);
                showNotification(`üéâ –í—ã –∑–∞–±—Ä–∞–ª–∏ –≤—ã–∏–≥—Ä—ã—à: ${payout.toFixed(2)} (${minesState.currentMultiplier.toFixed(2)}x)`, 'success');
            }
            hideLoader();
            
            // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ UI
            document.querySelectorAll('.mines-tile').forEach((t, i) => {
                t.classList.add('opened');
                if (minesState.minesLocations.includes(i) && !t.classList.contains('mine-hit')) {
                    t.innerHTML = 'üí£';
                } else if (!t.innerHTML) {
                     t.innerHTML = '‚≠ê';
                }
            });

            document.getElementById('minesStartButton').disabled = false;
            document.getElementById('minesCashoutButton').disabled = true;
            document.getElementById('minesMultiplier').textContent = '1.00x';
            document.getElementById('minesNextPayout').textContent = '0.00';
        }
        
        // ==================== –ü–†–û–ß–ï–ï ====================
        
        function showLoader() {
             document.getElementById('loader').style.display = 'flex';
        }
        
        function hideLoader() {
             document.getElementById('loader').style.display = 'none';
        }

        function showAuthModal(form) {
            document.getElementById('authModalTitle').textContent = form === 'login' ? '–í–•–û–î –í –ê–ö–ö–ê–£–ù–¢' : '–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø';
            document.getElementById('loginForm').style.display = form === 'login' ? 'block' : 'none';
            document.getElementById('registerForm').style.display = form === 'register' ? 'block' : 'none';
            document.getElementById('authModal').style.display = 'flex';
        }

        function showLoginForm() {
             showAuthModal('login');
        }

        function showRegisterForm() {
             showAuthModal('register');
        }
        
        function submitWithdrawal() {
             showNotification('–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤—ã–≤–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω –≤ –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏.', 'warning');
        }

        function showTerms() {
             document.getElementById('termsModal').style.display = 'flex';
        }
        
        function closeTerms() {
             document.getElementById('termsModal').style.display = 'none';
        }
        
        function showPrivacy() {
             showNotification('–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º —Å–æ–≥–ª–∞—à–µ–Ω–∏–∏', 'info');
        }

        function showMessages() {
             showNotification('–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —á–∞—Ç–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.', 'warning');
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================

        document.addEventListener('DOMContentLoaded', () => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä
            const gamesGrid = document.getElementById('gamesGrid');
            games.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = `game-card ${game.featured ? 'featured' : ''}`;
                gameCard.innerHTML = `
                    <div class="game-header">
                        <div class="game-icon">
                            <i class="${game.icon}"></i>
                        </div>
                        <h3 class="game-title">${game.title}</h3>
                        <div class="game-stats">
                            <span><i class="fas fa-coins"></i> –º–∏–Ω. ${game.minBet}</span>
                            <span><i class="fas fa-trophy"></i> –í—ã—Å–æ–∫–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å</span>
                        </div>
                    </div>
                    <div class="game-body">
                        <p class="game-description">${game.description}</p>
                        <button class="btn btn-game" onclick="openGame(${game.id})">
                            <i class="fas fa-play"></i> –ò–ì–†–ê–¢–¨
                        </button>
                    </div>
                `;
                gamesGrid.appendChild(gameCard);
            });
            
            loadProfile(); // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è ESC –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeModal();
                }
            });

            // –£–¥–∞–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è Plinko rows
        });
    </script>
</body>
</html>
